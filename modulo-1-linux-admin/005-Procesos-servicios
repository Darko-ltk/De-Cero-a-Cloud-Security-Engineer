
DÃA 5: GESTIÃ“N DE PROCESOS Y SERVICIOS

Objetivo: Dominar la gestiÃ³n de procesos del sistema y administraciÃ³n de servicios crÃ­ticos para seguridad

FUNDAMENTOS DE PROCESOS EN LINUX
Â¿QuÃ© son los Procesos?
Un proceso es una instancia en ejecuciÃ³n de un programa. Como Cloud Security Engineer, la gestiÃ³n de procesos es crÃ­tica porque:
    â€¢ DetecciÃ³n de malware: Procesos anÃ³malos pueden indicar compromiso del sistema
    â€¢ AnÃ¡lisis forense: Los procesos revelan actividad del atacante
    â€¢ OptimizaciÃ³n de recursos: Procesos mal gestionados crean vulnerabilidades
    â€¢ Monitoreo de seguridad: Procesos crÃ­ticos deben estar siempre funcionando
Tipos de Procesos
Procesos de usuario:
    â€¢ Ejecutados por usuarios del sistema
    â€¢ Tienen permisos limitados
    â€¢ Pueden ser terminados por el usuario propietario
Procesos del sistema (daemons):
    â€¢ Ejecutados en segundo plano
    â€¢ Proporcionan servicios crÃ­ticos (SSH, web, base de datos)
    â€¢ Generalmente ejecutados como root o usuarios especÃ­ficos
Procesos zombie:
    â€¢ Procesos terminados que no han sido limpiados
    â€¢ Pueden indicar problemas de programaciÃ³n o ataques
Estados de Procesos
# Ver estados de procesos
ps aux

# Estados posibles:
# R - Running (ejecutÃ¡ndose)
# S - Sleeping (durmiendo)
# D - Uninterruptible sleep (espera de I/O)
# Z - Zombie (terminado pero no limpiado)
# T - Stopped (detenido)
# X - Dead (muerto)

ğŸ” COMANDOS DE GESTIÃ“N DE PROCESOS
Comando ps - Visualizar Procesos
Sintaxis bÃ¡sica:
# Procesos del usuario actual
ps

# Todos los procesos del sistema
ps aux

# Procesos en formato Ã¡rbol (jerarquÃ­a)
ps auxf

# Procesos de un usuario especÃ­fico
ps -u admin

# Procesos con informaciÃ³n extendida
ps -eo pid,ppid,cmd,user,time,etime,pcpu,pmem

AnÃ¡lisis de salida ps aux:
USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
root         1  0.0  0.1 168548 11984 ?        Ss   10:30   0:01 /sbin/init
admin     1234  0.5  2.1 123456 87654 pts/0    S+   11:00   0:05 python3 app.py

Campos explicados:
    â€¢ USER: Usuario propietario del proceso
    â€¢ PID: Process ID (identificador Ãºnico)
    â€¢ %CPU: Porcentaje de CPU utilizado
    â€¢ %MEM: Porcentaje de memoria utilizado
    â€¢ VSZ: Memoria virtual total
    â€¢ RSS: Memoria fÃ­sica utilizada
    â€¢ TTY: Terminal asociado
    â€¢ STAT: Estado del proceso
    â€¢ START: Hora de inicio
    â€¢ TIME: Tiempo total de CPU utilizado
    â€¢ COMMAND: Comando ejecutado
Comando top - Monitor en Tiempo Real
# Monitor interactivo de procesos
top

# Comandos dentro de top:
# q - salir
# k - matar proceso (kill)
# r - cambiar prioridad (renice)
# M - ordenar por memoria
# P - ordenar por CPU
# u - filtrar por usuario
# 1 - mostrar todos los CPUs
# h - ayuda

InterpretaciÃ³n de la salida de top:
top - 11:30:45 up 1 day,  2:15,  2 users,  load average: 0.15, 0.25, 0.20
Tasks: 123 total,   1 running, 122 sleeping,   0 stopped,   0 zombie
%Cpu(s):  2.3 us,  1.1 sy,  0.0 ni, 96.4 id,  0.2 wa,  0.0 hi,  0.0 si,  0.0 st
MiB Mem :   3934.4 total,   2156.8 free,    892.1 used,    885.5 buff/cache
MiB Swap:   2048.0 total,   2048.0 free,      0.0 used.   2834.2 avail Mem

Significado de las mÃ©tricas:
    â€¢ load average: Carga promedio del sistema (1, 5, 15 minutos)
    â€¢ us: Tiempo de CPU en espacio de usuario
    â€¢ sy: Tiempo de CPU en espacio del kernel
    â€¢ id: Tiempo de CPU inactivo
    â€¢ wa: Tiempo esperando I/O
Comando htop - Monitor Avanzado
# Instalar htop (monitor mejorado)
sudo apt install htop

# Ejecutar htop
htop

# Ventajas sobre top:
# - Interfaz mÃ¡s intuitiva
# - NavegaciÃ³n con mouse
# - Filtros avanzados
# - VisualizaciÃ³n de Ã¡rbol de procesos
# - Colores para mejor legibilidad

Comando pgrep y pkill - BÃºsqueda y TerminaciÃ³n
# Buscar procesos por nombre
pgrep ssh
pgrep -f "python.*app.py"

# Buscar con informaciÃ³n adicional
pgrep -l ssh
pgrep -u admin python

# Matar procesos por nombre
pkill firefox
pkill -u admin python

# Matar con seÃ±al especÃ­fica
pkill -9 proceso_colgado
pkill -TERM apache2

SEÃ‘ALES DE PROCESOS
Tipos de SeÃ±ales
Las seÃ±ales son mecanismos de comunicaciÃ³n entre procesos y el kernel:
# Ver todas las seÃ±ales disponibles
kill -l

# SeÃ±ales mÃ¡s importantes:
# SIGTERM (15) - TerminaciÃ³n elegante (por defecto)
# SIGKILL (9)  - TerminaciÃ³n forzada (no se puede ignorar)
# SIGHUP (1)   - Hang up (recargar configuraciÃ³n)
# SIGINT (2)   - InterrupciÃ³n (Ctrl+C)
# SIGSTOP (19) - Pausar proceso
# SIGCONT (18) - Continuar proceso pausado

Comando kill - Enviar SeÃ±ales
# Terminar proceso elegantemente
kill 1234

# Terminar proceso forzadamente
kill -9 1234
kill -KILL 1234

# Recargar configuraciÃ³n de servicio
kill -HUP 1234
kill -1 1234

# Pausar proceso
kill -STOP 1234

# Continuar proceso pausado
kill -CONT 1234

# Matar todos los procesos de un usuario
sudo pkill -u usuario_malicioso

ğŸ›ï¸ CONTROL DE TRABAJOS (JOBS)
EjecuciÃ³n en Primer y Segundo Plano
# Ejecutar comando en segundo plano
comando &

# Ejemplo: servidor web de desarrollo
python3 -m http.server 8080 &

# Ver trabajos en ejecuciÃ³n
jobs

# Traer trabajo a primer plano
fg %1

# Enviar trabajo a segundo plano
bg %1

# Suspender trabajo actual (Ctrl+Z)
# Luego continuar en segundo plano:
bg

Comando nohup - Procesos Persistentes
# Ejecutar comando que persiste despuÃ©s del logout
nohup python3 aplicacion.py &

# Redirigir salida a archivo especÃ­fico
nohup ./script.sh > output.log 2>&1 &

# Ver procesos nohup
ps aux | grep nohup

Comando screen y tmux - Sesiones Persistentes
# Instalar screen
sudo apt install screen

# Crear nueva sesiÃ³n
screen -S mi_sesion

# Listar sesiones
screen -ls

# Reconectar a sesiÃ³n
screen -r mi_sesion

# Desconectar sesiÃ³n (Ctrl+A, D)

# Instalar tmux (alternativa moderna)
sudo apt install tmux

# Crear sesiÃ³n tmux
tmux new-session -s trabajo

# Listar sesiones tmux
tmux list-sessions

# Reconectar a sesiÃ³n tmux
tmux attach-session -t trabajo

ğŸ”§ GESTIÃ“N DE SERVICIOS CON SYSTEMD
Â¿QuÃ© es systemd?
systemd es el sistema de inicializaciÃ³n y gestiÃ³n de servicios en Ubuntu Server. Como Cloud Security Engineer, debes dominarlo porque:
    â€¢ Servicios crÃ­ticos: SSH, firewall, web servers dependen de systemd
    â€¢ Logs centralizados: journald proporciona logging unificado
    â€¢ Seguridad: Control granular de permisos y recursos
    â€¢ AutomatizaciÃ³n: Inicio automÃ¡tico de servicios crÃ­ticos
Comando systemctl - Control de Servicios
GestiÃ³n bÃ¡sica de servicios:
# Ver estado de un servicio
systemctl status ssh

# Iniciar servicio
sudo systemctl start apache2

# Detener servicio
sudo systemctl stop apache2

# Reiniciar servicio
sudo systemctl restart nginx

# Recargar configuraciÃ³n sin reiniciar
sudo systemctl reload nginx

# Habilitar servicio para inicio automÃ¡tico
sudo systemctl enable ssh

# Deshabilitar servicio
sudo systemctl disable apache2

# Ver si servicio estÃ¡ habilitado
systemctl is-enabled ssh

# Ver si servicio estÃ¡ activo
systemctl is-active nginx

Listado y bÃºsqueda de servicios:
# Listar todos los servicios
systemctl list-units --type=service

# Listar servicios activos
systemctl list-units --type=service --state=active

# Listar servicios fallidos
systemctl list-units --type=service --state=failed

# Buscar servicios por patrÃ³n
systemctl list-units --type=service | grep ssh

# Ver servicios habilitados para inicio automÃ¡tico
systemctl list-unit-files --type=service --state=enabled

AnÃ¡lisis de Estado de Servicios
# Estado detallado de servicio
systemctl status ssh

# Salida tÃ­pica:
â— ssh.service - OpenBSD Secure Shell server
     Loaded: loaded (/lib/systemd/system/ssh.service; enabled; vendor preset: enabled)
     Active: active (running) since Wed 2025-06-19 10:30:15 UTC; 2h 15min ago
       Docs: man:sshd(8)
             man:sshd_config(5)
    Process: 1234 ExecStartPre=/usr/sbin/sshd -t (code=exited, status=0/SUCCESS)
   Main PID: 1235 (sshd)
      Tasks: 1 (limit: 4915)
     Memory: 2.1M
        CPU: 15ms
     CGroup: /system.slice/ssh.service
             â””â”€1235 /usr/sbin/sshd -D

InterpretaciÃ³n del estado:
    â€¢ Loaded: Servicio cargado y ubicaciÃ³n del archivo de configuraciÃ³n
    â€¢ Active: Estado actual (active/inactive/failed)
    â€¢ Main PID: Proceso principal del servicio
    â€¢ Tasks: NÃºmero de tareas/hilos
    â€¢ Memory/CPU: Uso de recursos
    â€¢ CGroup: Grupo de control para gestiÃ³n de recursos
MONITOREO DE RECURSOS DEL SISTEMA
Comando free - Memoria del Sistema
# InformaciÃ³n de memoria
free -h

# Salida tÃ­pica:
               total        used        free      shared  buff/cache   available
Mem:           3.8Gi       856Mi       2.1Gi        12Mi       885Mi       2.8Gi
Swap:          2.0Gi          0B       2.0Gi

# Monitoreo continuo cada 2 segundos
free -h -s 2

Comando df - Espacio en Disco
# Uso de disco por sistemas de archivos
df -h

# Uso de disco con tipos de sistema de archivos
df -hT

# Uso de inodos
df -i

# Monitorear directorio especÃ­fico
du -sh /var/log/
du -h --max-depth=1 /var/

Comando iostat - EstadÃ­sticas de I/O
# Instalar herramientas de sistema
sudo apt install sysstat

# EstadÃ­sticas de I/O
iostat

# Monitoreo continuo cada 2 segundos
iostat 2

# EstadÃ­sticas extendidas
iostat -x 2

Comando sar - Reporte de Actividad del Sistema
# Uso de CPU
sar -u 1 5

# Uso de memoria
sar -r 1 5

# Actividad de red
sar -n DEV 1 5

# Actividad de disco
sar -d 1 5

# Reporte histÃ³rico (si estÃ¡ configurado)
sar -u -f /var/log/sysstat/saXX

RECURSOS GRATUITOS PARA HOY
Recurso Principal: Linux Journey - Processes
URL: https://linuxjourney.com/lesson/monitor-processes-ps-command
MÃ³dulos especÃ­ficos para hoy:
    â€¢ Monitor Processes: Comando ps y variantes
    â€¢ Process Control: SeÃ±ales y control de trabajos
    â€¢ Job Control: GestiÃ³n de trabajos en background
Recurso Complementario: Ubuntu Server Guide - Process Management
URL: https://ubuntu.com/server/docs/service-management
Secciones relevantes:
    â€¢ Service Management: GestiÃ³n con systemd
    â€¢ Process Monitoring: Monitoreo de procesos
    â€¢ System Resources: GestiÃ³n de recursos
Recurso de Systemd: Digital Ocean Guide
URL: https://www.digitalocean.com/community/tutorials/how-to-use-systemctl-to-manage-systemd-services-and-units
Contenido clave:
    â€¢ GestiÃ³n completa de servicios systemd
    â€¢ ConfiguraciÃ³n de servicios personalizados
    â€¢ Troubleshooting de servicios
Herramienta de PrÃ¡ctica: Htop Explained
URL: https://peteris.rocks/blog/htop/
Utilidad:
    â€¢ ExplicaciÃ³n detallada de htop
    â€¢ InterpretaciÃ³n de mÃ©tricas
    â€¢ OptimizaciÃ³n de rendimiento
ğŸ› ï¸ EJERCICIOS PRÃCTICOS DEL DÃA
Laboratorio 1: AnÃ¡lisis de Procesos del Sistema
# 1. Explorar procesos actuales
ps aux | head -20

# 2. Identificar procesos que consumen mÃ¡s CPU
ps aux --sort=-%cpu | head -10

# 3. Identificar procesos que consumen mÃ¡s memoria
ps aux --sort=-%mem | head -10

# 4. Buscar procesos especÃ­ficos
pgrep -l ssh
pgrep -l systemd

# 5. Analizar jerarquÃ­a de procesos
ps auxf | grep -A 5 -B 5 ssh

# 6. Crear reporte de procesos
echo "=== REPORTE DE PROCESOS $(date) ===" > ~/proceso_report.txt
echo "=== TOP 5 CPU ===" >> ~/proceso_report.txt
ps aux --sort=-%cpu | head -6 >> ~/proceso_report.txt
echo "=== TOP 5 MEMORIA ===" >> ~/proceso_report.txt
ps aux --sort=-%mem | head -6 >> ~/proceso_report.txt

Laboratorio 2: GestiÃ³n de Servicios CrÃ­ticos
# 1. Verificar servicios crÃ­ticos de seguridad
systemctl status ssh
systemctl status ufw
systemctl status fail2ban

# 2. Analizar servicios en ejecuciÃ³n
systemctl list-units --type=service --state=running

# 3. Identificar servicios fallidos
systemctl list-units --type=service --state=failed

# 4. Verificar servicios habilitados para inicio automÃ¡tico
systemctl list-unit-files --type=service --state=enabled

# 5. Crear servicio personalizado de monitoreo
sudo tee /etc/systemd/system/monitor-security.service > /dev/null <<EOF
[Unit]
Description=Security Monitor Service
After=network.target

[Service]
Type=simple
User=admin
ExecStart=/bin/bash -c 'while true; do echo "$(date): Security check" >> /var/log/security-monitor.log; sleep 300; done'
Restart=always

[Install]
WantedBy=multi-user.target
EOF

# 6. Habilitar y probar el servicio
sudo systemctl daemon-reload
sudo systemctl enable monitor-security.service
sudo systemctl start monitor-security.service
sudo systemctl status monitor-security.service

Laboratorio 3: Monitoreo de Recursos y Rendimiento
# 1. Crear script de monitoreo
cat > ~/system_monitor.sh << 'EOF'
#!/bin/bash
echo "=== MONITOREO DEL SISTEMA $(date) ==="
echo "=== CARGA DEL SISTEMA ==="
uptime
echo ""
echo "=== USO DE MEMORIA ==="
free -h
echo ""
echo "=== USO DE DISCO ==="
df -h
echo ""
echo "=== TOP 5 PROCESOS POR CPU ==="
ps aux --sort=-%cpu | head -6
echo ""
echo "=== TOP 5 PROCESOS POR MEMORIA ==="
ps aux --sort=-%mem | head -6
echo ""
echo "=== SERVICIOS CRÃTICOS ==="
systemctl is-active ssh ufw
echo "================================"
EOF

# 2. Hacer ejecutable el script
chmod +x ~/system_monitor.sh

# 3. Ejecutar monitoreo
./system_monitor.sh

# 4. Programar monitoreo automÃ¡tico (cada 10 minutos)
# AÃ±adir a crontab:
# */10 * * * * /home/admin/system_monitor.sh >> /var/log/system_monitor.log

# 5. Simular carga del sistema para pruebas
# Terminal 1: Simular carga CPU
yes > /dev/null &
PID_CPU=$!

# Terminal 2: Monitorear en tiempo real
htop

# Terminar simulaciÃ³n
kill $PID_CPU

# 6. Analizar logs del sistema
sudo tail -f /var/log/syslog | grep -E "(error|warning|critical)"




ğŸ“Š Progreso general: 5/365 dÃ­as (1.37%)
MaÃ±ana aprenderemos la gestiÃ³n de paquetes y actualizaciones de seguridad, elementos fundamentales para mantener sistemas seguros y actualizados contra las Ãºltimas amenazas. Â¡Tu expertise en administraciÃ³n de sistemas se consolida cada dÃ­a!
